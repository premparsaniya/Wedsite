{"version":3,"file":"SendETH-9f7f64d6.js","sources":["../../src/pages/Wallet/SendETH.tsx"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\r\nimport { AvailableBalanceCard, BTN, Modal, TxtInput } from \"~/components\";\r\nimport { goerlyTestNetURL, mainNetURL } from \"~/utils\";\r\nimport { toast } from \"react-toastify\";\r\nimport { AppContext } from \"~/context\";\r\nimport Web3 from \"web3\";\r\n\r\nconst SendETH = () => {\r\n    const { state: { myWallet: { isMainNet, address: myAddress, privateKey } } } = useContext(AppContext);\r\n    const web3 = new Web3(isMainNet === true ? mainNetURL : goerlyTestNetURL);\r\n    const [address, setAddress] = useState('');\r\n    const [amount, setAmount] = useState('');\r\n    const [showConform, setShowConform] = useState(false);\r\n    const [gasFeesVal, setGasFeesVal] = useState(\"0\");\r\n    const [nonce, setNonce] = useState<number | undefined>();\r\n    const [gasPriceIs, setGasPriceIs] = useState(\"0\");\r\n\r\n    const onSend = async () => {\r\n        const rawTransaction = privateKey && myAddress && web3.eth.accounts.signTransaction({\r\n            from: myAddress, to: address, value: web3.utils.toWei(amount, 'ether'), nonce,\r\n            gas: 21000, gasPrice: gasPriceIs,\r\n        }, privateKey);\r\n        // send the signed transaction to the network //console.log(\"rawTransaction\", rawTransaction);\r\n        rawTransaction && web3.eth.sendSignedTransaction((await rawTransaction)?.rawTransaction || \"\").then(({ transactionHash }) => {\r\n            console.log(\"transactionHash\", transactionHash);\r\n        }).catch((err) => { console.error(\"err:::\", err); });\r\n    };\r\n\r\n    function onConform() {\r\n        if (address?.trim()?.length === 0) { toast.error(\"Please enter address\", { position: \"top-center\" }); return; };\r\n        if (address?.trim()?.length !== 42) { toast.error(\"Please enter valid address\", { position: \"top-center\" }); return; };\r\n        if (amount?.trim()?.length === 0) { toast.error(\"Please enter amount\", { position: \"top-center\" }); return; };\r\n        if (parseFloat(amount) <= 0) { toast.error(\"Please enter valid amount\", { position: \"top-center\" }); return; };\r\n        setShowConform(true);\r\n    };\r\n    const onClose = () => setShowConform(false);\r\n\r\n    useEffect(() => {\r\n        (privateKey || myAddress) === null ? /* getWallet({ myWallet, dispatch }) */ null : (estimatedGasFees(), getNonce())\r\n    }, [myAddress, isMainNet]);\r\n\r\n\r\n    async function getNonce() {\r\n        return myAddress ? await web3.eth.getTransactionCount(myAddress).then((result) => {\r\n            setNonce(result); //console.log(\"nonce\", result);\r\n            return result;\r\n        }) : undefined;\r\n    };\r\n\r\n    async function estimatedGasFees() {\r\n        return await web3.eth.getGasPrice().then((result) => {\r\n            setGasPriceIs(result); // console.log(\"resultGASSS\", result);\r\n            let gasPrice = web3.utils.fromWei(result, 'ether');\r\n            let gasFees = parseFloat(gasPrice) * 21000;\r\n            console.log(\"gasFees::::\", gasFees);\r\n            setGasFeesVal(gasFees.toFixed(12)); //console.log(\"gasFees\", gasFees);\r\n            return gasFees;\r\n        });\r\n    };\r\n\r\n    let totalPrice = parseFloat(amount) + parseFloat(gasFeesVal);\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center min-h-screen py-20 bg-white min-w-screen px-3.5\">\r\n            <AvailableBalanceCard />\r\n            <span className=\"font-lato font-bold text-xl text-center text-black mx-[2%] mt-[2%] mb-2\">Please fill in the form to send ETH</span>\r\n            <TxtInput\r\n                pHolder=\"Address\"\r\n                val={address}\r\n                onChangeT={setAddress}\r\n            />\r\n            <TxtInput\r\n                pHolder=\"Amount\"\r\n                val={amount}\r\n                onChangeT={t => {\r\n                    if (t === \"--\" || t === \"-\" || t === \"\") {\r\n                        setAmount(\"\"); return;\r\n                    } else {\r\n                        const num = parseFloat(t);\r\n                        if (num < 0) { setAmount(\"\"); return; }\r\n                        setAmount(t);\r\n                    }\r\n                }}\r\n                rLabel=\"ETH\"\r\n                type=\"number\"\r\n            />\r\n\r\n            <BTN title=\"Send ETH\" className='mt-8 px-[7%] text-base' onP={onConform} />\r\n            <Modal visible={showConform} onClose={onClose} saveBtnTxt=\"Send\" onSave={onSend} title=\"Confirm Transaction\" subClass=\"w-[100%] mx-1 sm:mx-10 \">\r\n                <div className=\"flex justify-between border-t-[1px] border-gray-300 px-4 pt-2\">\r\n                    <span className=\"text-sm text-gray-600 md:text-base\">Amount</span>\r\n                    <span className={`block text-[14px] md:text-lg font-lato`}>{amount}</span>\r\n                </div>\r\n                <div className=\"flex justify-between px-4 pt-2 border-gray-300\">\r\n                    <span className=\"text-sm text-gray-600 md:text-base Estimated gas fee\">Estimated gas fee</span>\r\n                    <span className={`block text-[14px] md:text-lg font-lato`}>{gasFeesVal}</span>\r\n                </div>\r\n                <div className=\"flex justify-between px-4 pt-4 border-t-[1px] border-black mt-4\">\r\n                    <span className=\"text-sm text-agray-600 md:text-base\">Total</span>\r\n                    <span className={`block text-[14px] md:text-lg font-lato`}>{totalPrice.toFixed(12)}</span>\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default SendETH"],"names":["SendETH","isMainNet","myAddress","privateKey","useContext","AppContext","web3","Web3","mainNetURL","goerlyTestNetURL","address","setAddress","useState","amount","setAmount","showConform","setShowConform","gasFeesVal","setGasFeesVal","nonce","setNonce","gasPriceIs","setGasPriceIs","onSend","rawTransaction","_a","transactionHash","err","onConform","toast","_b","_c","onClose","useEffect","estimatedGasFees","getNonce","result","gasPrice","gasFees","totalPrice","jsxs","jsx","AvailableBalanceCard","TxtInput","t","BTN","Modal"],"mappings":"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"}