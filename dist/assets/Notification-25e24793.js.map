{"version":3,"file":"Notification-25e24793.js","sources":["../../src/components/ForPagination/NotificationCards.tsx","../../src/pages/Notification.tsx"],"sourcesContent":["import moment from \"moment\";\nimport { forwardRef, Fragment } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { CLOSE_ICON, RIGHT_ICON } from \"~/assets\";\nimport { DEF_USER } from \"~/assets\";\nimport SpinningLoader from \"../Animation/SpinningLoader\";\nimport 'moment-timezone';\ntype Props = {\n    item: any;\n    index: number;\n    rLoading: boolean;\n    aLoading: boolean;\n    goProfile: (n: number) => void;\n    acceptRequest: (s: string) => void;\n    rejectRequest: (s: string) => void;\n};\n\nconst NotificationCards = forwardRef(({ item, index, aLoading, rLoading, goProfile, acceptRequest, rejectRequest }: Props, ref: any) => {\n\n    const { user } = useSelector((state: any) => state.UserLogin);\n\n    const postCardBody = (\n        <Fragment key={index}>\n            <div className=\"notification-follow-list-box \">\n                <div className=\"notification-follow-list\">\n                    <img\n                        src={item?.sender?.photo || DEF_USER}\n                        alt=\"Profile\"\n                        className=\"profile-size cursor-pointer\"\n                        style={{ marginLeft: \"10px\" }}\n                        onClick={() => goProfile(item?.sender?.user_id)}\n                        crossOrigin=\"anonymous\"\n                    />\n                    <div className=\"notification-flex\">\n                        <div className=\"user_name cursor-pointer\">\n                            <span onClick={() => goProfile(item?.sender?.user_id)}>\n                                {item?.sender?.name}\n                                <span className=\"text-sm text-gray-400 ml-1\">\n                                    {item?.notification}\n                                </span>\n                            </span>\n                            <span className=\"notification-font\">                           \n                                    {moment.tz(item?.reg_date, 'MET').startOf(item?.reg_date).fromNow()}\n                            </span>\n                        </div>\n                        {user?.data?.settings?.profile === \"0\" &&\n                            item?.slug === \"follow_request\" ? (\n                            <div className=\"notification-btn\">\n                                <div\n                                    className=\"notification-right\"\n                                    onClick={() => acceptRequest(item?.sender?.user_id)}\n                                >\n                                    {aLoading ? (\n                                        <SpinningLoader\n                                            isLoading={aLoading}\n                                            className=\"ctr\"\n                                        />\n                                    ) : (\n                                        <img\n                                            src={RIGHT_ICON}\n                                            alt=\"Right-icon\"\n                                            className=\"cursor-pointer\"\n                                        />\n                                    )}\n                                </div>\n                                <div\n                                    className=\"notification-close\"\n                                    onClick={() => rejectRequest(item?.sender?.user_id)}\n                                >\n                                    {rLoading ? (\n                                        <SpinningLoader\n                                            isLoading={rLoading}\n                                            className=\"ctr\"\n                                        />\n                                    ) : (\n                                        <img\n                                            src={CLOSE_ICON}\n                                            alt=\"close-icon\"\n                                            className=\"cursor-pointer\"\n                                        />\n                                    )}\n                                </div>\n                            </div>\n                        ) : null}\n                    </div>\n                </div>\n            </div>\n        </Fragment>\n    );\n    const content = ref ? (\n        <div ref={ref}>{postCardBody}</div>\n    ) : (\n        <div>{postCardBody}</div>\n    );\n    return content;\n});\n\nexport default NotificationCards","import { useCallback, useContext, useEffect, useRef, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport { BTN, SpinningLoader } from \"~/components\";\nimport NotificationCards from \"~/components/ForPagination/NotificationCards\";\nimport { DELETE_ICON } from \"../assets\";\nimport { LogoutUser, LogoutUserPost } from \"~/reduxState\";\nimport { AppContext, resetUser } from \"~/context\";\n\nfunction Notification() {\n  const { user } = useSelector((state: any) => state.UserLogin);\n  const { dispatch: disp } = useContext(AppContext);\n  const [nValue, setNValue] = useState<any>([]);\n  const [btnToggle, setBtnToggle] = useState<boolean>(false);\n  const [rLoading, setRLoading] = useState<boolean>(false);\n  const [aLoading, setALoading] = useState<boolean>(false);\n\n  const [hasNextPage, setHasNextPage] = useState(false);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [pageNo, setPageNo] = useState<number>(1);\n  const limit = 10;\n\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const token = user?.token;\n\n  useEffect(() => {\n    getAllNotification();\n  }, [pageNo]);\n\n  // console.log(\"user\", user);\n\n  const getAllNotification = () => {\n    setLoading(true);\n    const obj = {\n      method: \"get_notifications\",\n      user_id: user.data.user_id,\n      page: pageNo,\n      limit: limit,\n    };\n\n    fetch(`${import.meta.env.VITE_API_URL}profile`, {\n      method: \"POST\",\n      headers: {\n        accept: \"application/json\",\n        contentType: \"application/json\",\n        version: \"1.0.0\",\n        token: `Bearer ${token}`,\n      },\n      body: JSON.stringify(obj),\n    }).then((res) => {\n      res\n        .json()\n        .then((response) => {\n          if (response.status === 1) {\n            let pLimit = limit;\n            let pData = response?.data?.length;\n            setHasNextPage(pData >= pLimit);\n            if (pageNo === 1) {\n              setNValue(response.data);\n            } else {\n              let clone = [...nValue];\n              response?.data && clone.push(...response?.data);\n              setNValue(clone);\n            }\n          }\n          if (response.status === 2) {\n            toast.error(\"Your session is expired. Please login to access your account\", {\n              position: \"top-center\",\n            });\n            dispatch(LogoutUser());\n            dispatch(LogoutUserPost());\n            navigate(\"/\");\n            resetUser(disp);\n          }\n        })\n        .finally(() => setLoading(false));\n    });\n  };\n\n  const acceptRequest = (id: string) => {\n    setALoading(true);\n    const obj = {\n      method: \"accept_follow_request\",\n      user_id: user.data.user_id,\n      user_2: id,\n    };\n    // console.log(obj);\n    fetch(`${import.meta.env.VITE_API_URL}profile`, {\n      method: \"POST\",\n      headers: {\n        accept: \"application/json\",\n        contentType: \"application/json\",\n        version: \"1.0.0\",\n        token: `Bearer ${token}`,\n      },\n      body: JSON.stringify(obj),\n    }).then((res) => {\n      res.json().then((response) => {\n        if (response.status === 1) {\n          setBtnToggle(!btnToggle);\n          setALoading(false);\n          getAllNotification();\n          toast.success(`${response.message}`, {\n            position: \"top-center\",\n            autoClose: 300,\n          });\n        } else {\n          // console.log(\"else 1\", response);\n        }\n      });\n    });\n  };\n  const rejectRequest = (id: string) => {\n    setRLoading(true);\n    const obj = {\n      method: \"reject_follow_request\",\n      user_id: user.data.user_id,\n      user_2: id,\n    };\n\n    // console.log(obj);\n    fetch(`${import.meta.env.VITE_API_URL}profile`, {\n      method: \"POST\",\n      headers: {\n        accept: \"application/json\",\n        contentType: \"application/json\",\n        version: \"1.0.0\",\n        token: `Bearer ${token}`,\n      },\n      body: JSON.stringify(obj),\n    }).then((res) => {\n      res.json().then((response) => {\n        if (response.status === 1) {\n          // console.log(\"reject_follow_request\", response);\n          setBtnToggle(!btnToggle);\n          setRLoading(false);\n          getAllNotification();\n          toast.success(`${response.message}`, {\n            position: \"top-center\",\n            autoClose: 300,\n          });\n        } else {\n          // console.log(\"else 1\", response);\n        }\n      });\n    });\n  };\n\n  const deleteNotification = () => {\n    setLoading(true);\n    const obj = {\n      method: \"delete_all_notifications\",\n      user_id: user.data.user_id,\n    };\n\n    fetch(`${import.meta.env.VITE_API_URL}profile`, {\n      method: \"POST\",\n      headers: {\n        accept: \"application/json\",\n        contentType: \"application/json\",\n        version: \"1.0.0\",\n        token: `Bearer ${token}`,\n      },\n      body: JSON.stringify(obj),\n    }).then((res) => {\n      res.json().then((response) => {\n        if (response.status === 1) {\n          setNValue([]);\n          setLoading(false);\n        } else {\n          setLoading(false);\n          // console.log(\"else 1\", response);\n        }\n      });\n    });\n  };\n\n  const goProfile = (id: number) => {\n    navigate(`/userprofile/${id}`);\n  };\n\n  const intObserver = useRef<any>();\n  const lastPostRef = useCallback(\n    (post: any) => {\n      if (loading) return;\n      if (intObserver.current) intObserver.current.disconnect();\n\n      intObserver.current = new IntersectionObserver((posts) => {        \n        if (posts[0].isIntersecting && hasNextPage) {\n          setPageNo((prev) => prev + 1);\n        }\n      });\n\n      if (post) intObserver.current.observe(post);\n    },\n    [loading, hasNextPage]\n  );\n\n  return (\n    <section className=\"discover-p_m\">\n      <div className=\"discover-box\">\n        <div className=\"relative justify-center discover-header\">\n          Notification\n          <img\n            src={DELETE_ICON}\n            alt=\"dlt\"\n            onClick={() => deleteNotification()}\n            className=\"absolute ml-[90%] cursor-pointer\"\n          />\n          {/* <BTN className=\"px-32\"\n                onP={deleteNotification}\n                loading={myLoading}\n                title=\"Log In\"\n                disabled={\n                  myLoading || (un !== \"\" && pass !== \"\" && terms)\n                    ? false\n                    : true\n                } /> */}\n        </div>\n        <div className=\"discover-border\" style={{ marginBottom: \"10px\" }}></div>\n        <div className=\"\" style={{ maxHeight: \"700px\", overflow: \"scroll\" }}>\n          {nValue?.length > 0\n            ? nValue.map((item: any, index: number) => {\n              return nValue?.length === index + 1 ? (\n                <NotificationCards\n                  key={index}\n                  item={item}\n                  index={index}\n                  goProfile={goProfile}\n                  aLoading={aLoading}\n                  rLoading={rLoading}\n                  acceptRequest={acceptRequest}\n                  rejectRequest={rejectRequest}\n                  ref={lastPostRef}\n                />\n              ) : (\n                <NotificationCards\n                  key={index}\n                  item={item}\n                  index={index}\n                  goProfile={goProfile}\n                  aLoading={aLoading}\n                  rLoading={rLoading}\n                  acceptRequest={acceptRequest}\n                  rejectRequest={rejectRequest}\n                />\n              );\n            })\n            : !loading && <p className=\"text-center pt-[40%] \" >No notifications yet !!</p>}\n          {loading && (\n            <SpinningLoader\n              isLoading\n              colClass=\"text-black \"\n              size={10}\n              className=\"flex items-center justify-center w-full mb-4\"\n            />\n          )}\n        </div>\n      </div>\n    </section>\n  );\n}\nexport default Notification;"],"names":["NotificationCards","forwardRef","item","index","aLoading","rLoading","goProfile","acceptRequest","rejectRequest","ref","user","useSelector","state","postCardBody","jsx","Fragment","jsxs","_a","DEF_USER","_b","_d","_c","SpinningLoader","RIGHT_ICON","CLOSE_ICON","Notification","disp","useContext","AppContext","nValue","setNValue","useState","btnToggle","setBtnToggle","setRLoading","setALoading","hasNextPage","setHasNextPage","loading","setLoading","pageNo","setPageNo","limit","dispatch","useDispatch","navigate","useNavigate","token","useEffect","getAllNotification","obj","res","response","pLimit","pData","clone","toast","LogoutUser","LogoutUserPost","resetUser","id","deleteNotification","intObserver","useRef","lastPostRef","useCallback","post","posts","prev","DELETE_ICON"],"mappings":"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"}